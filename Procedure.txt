Text
CREATE PROCEDURE USP_TDS_GetDeductorAndResponsiblePerson

@BRANCHID INT,  

@FORMID INT = -1,

@QUARTER INT  

AS  

	BEGIN 		   

		DECLARE @TOKENNO VARCHAR(15);	  

		SELECT @TOKENNO = TOKENNO FROM ACKNO WHERE BRANCHID = @BRANCHID AND FORMID = @FORMID AND QUARTER = @QUARTER 

		SELECT D.DEDUCTORID AS DEDUCTORID,D.DEDUCTORNAME AS DeductorName,D.ADDRESS1 AS DADDRESS1,D.ADDRESS2 AS DADDRESS2,D.ADDRESS3 AS DADDRESS3,  

			 D.ADDRESS4 AS DADDRESS4,D.ADDRESS5 AS DADDRESS5,D.STATEID AS DSTATEID,D.ISADDRCHANGED AS DISADDRESSCHANGED,  

			 D.FINANCIALYEAR,D.[TAN] AS DTAN,D.PAN AS DPAN,D.PINCODE AS DPINCODE,D.EMAILADDRESS AS DEMAILADDRESS,  

			 D.STDCODE AS DSTDCODE,D.PHONENO AS DPHONENUMBER,D.ISRESIDENT AS DISRESIDENT,D.ISTDSEXISTING AS DISTDSEXISTING,  

			 D.FAXNO AS DFAXNUMBER,D.RETURNTYPE AS RETURNTYPE,D.ISAOAPPROVED AS DISAOAPPROVED,D.STATUSID AS STATUSID,  

			@TOKENNO AS DAOAPPROVALNUMBER,D.AODESIGNATION AS DAODESIGNATION,D.DEDUCTORTYPEID AS DEDUCTORTYPEID,  

			D.GOVTADDSTATEID ,D.GOVTADDPAOCODE,D.GOVTADDPAOREGNNO,D.GOVTADDDDOCODE,D.GOVTADDDDOREGNNO,   

			D.GOVTADDMINISTRY,D.GOVTADDMAINMINISTRY,D.GOVTADDAIN,D.GOVTADDOTHERNAME,D.TANREGISTRATION,  

			RP.PERSONID AS RPID,RP.PERSONNAME AS RPNAME,RP.ADDRESS1 AS RPADDRESS1,RP.ADDRESS2 AS RPADDRESS2,  

			RP.ADDRESS3 AS RPADDRESS3,RP.ADDRESS4 AS RPADDRESS4,RP.ADDRESS5 AS RPADDRESS5,RP.PINCODE AS RPPINCODE,  

			RP.STATEID AS RPSTATEID,RP.ISADDRCHANGED AS RPISADDRESSCHANGED,RP.DESIGNATION AS RPDESIGNATION,  

			RP.EMAILADDRESS AS RPEMAILADDRESS,RP.STDCODE AS RPSTDCODE,RP.PHONENO AS RPPHONENUMBER,   

			RP.MOBILENO AS RPMOBILENUMBER,RP.FAXNO AS RPFAXNUMBER,RP.GENDER AS RPGENDER,RP.FATHERNAME AS RPFATHERNAME,  

			BD.[QUARTER] AS [QUARTER],BD.BRANCHID AS BRANCHID, D.ALTERNATEEMAIL AS DALTERNATEEMAIL,D.ALTERNATESTD AS DALTERNATESTD,  

			D.ALTERNATEPHONE AS DALTERNATEPHONE,RP.ALTERNATEEMAIL AS RPALTERNATEEMAIL, RP.ALTERNATESTD AS RPALTERNATESTD,  

			RP.ALTERNATEPHONE AS RPALTERNATEPHONE, DT.CATEGORYCODE, ISNULL(D.GSTIN,'') GSTIN

		FROM DEDUCTOR D WITH(NOLOCK) 

			INNER JOIN DEDUCTORTYPE DT WITH(NOLOCK) ON D.DEDUCTORTYPEID = DT.DEDUCTORTYPEID 

			LEFT JOIN RESPONSIBLEPERSON RP WITH(NOLOCK) ON D.DEDUCTORID=RP.DEDUCTORID   

			INNER JOIN BRANCHDEDUCTORS BD WITH(NOLOCK) ON D.DEDUCTORID=BD.DEDUCTORID   

		WHERE BRANCHID=@BRANCHID  AND [QUARTER] =@QUARTER;  

	END


